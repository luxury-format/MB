{{ $pages := .Site.RegularPages }}
{{ $pages = where $pages "Title" "ne" "" }}
{{ $pages = where $pages "Kind"  "page" }}
{{ $pages = where $pages "Type"  "in"    (slice "page" "archive" "redirect" "photos") }}
{{ $pages = where $pages "Type"  "not in" (slice "2025" "categories" "post" "surpriseme") }}
{{ $pages = where $pages "Kind"  "not in" (slice "section" "taxonomy" "home" "term") }}
{{ $pages = where $pages "Layout" "ne"    "post" }}
{{ $pages = where $pages "Section" "not in" (slice "2025" "categories") }}
{{ $pages = sort $pages "Permalink" }}

<ul class="allpages">
  {{ range $pages }}
    {{ $cleanRelPermalink := .RelPermalink | strings.TrimSuffix ".html" | strings.TrimSuffix "/" }}
    
    {{ if .Params.redirect }}
      {{ $redirectUrl := .Params.redirect }}
      {{ $linkTitle := "" }}
      
      {{ if hasPrefix $redirectUrl "/" }}
        {{ $slashPageRelPermalink := $redirectUrl | strings.TrimPrefix "/" | strings.TrimSuffix ".html" | strings.TrimSuffix "/" }}
        {{ $linkTitle = printf "/%s" $slashPageRelPermalink }}
      
      {{ else if or (eq $redirectUrl $.Site.BaseURL) (hasPrefix $redirectUrl $.Site.BaseURL) }}
        {{ $linkTitle = $.Site.BaseURL | 
            replaceRE "^https?://" "" | 
            replaceRE "^www\\." "" | 
            strings.TrimSuffix "/" }}
      
      {{ else }}
        {{ $linkTitle = $redirectUrl | 
            replaceRE "^https?://" "" | 
            replaceRE "^www\\." "" | 
            strings.TrimSuffix "/" }}
      {{ end }}

      <li>
        <a href="{{ .Permalink }}"><strong>{{ upper .Title }}</strong></a> - 
        <a href="{{ .Permalink }}">{{ $cleanRelPermalink }}</a> - 
        redirect to â†’ 
        <a href="{{ .Params.redirect }}" title="{{ $linkTitle }}">{{ $linkTitle }}</a>
      </li>
    {{ else }}
      <li><a href="{{ .Permalink }}"><strong>{{ upper .Title }}</strong></a> - <a href="{{ .Permalink }}">{{ $cleanRelPermalink }}</a></li>
    {{ end }}
  {{ end }}
</ul>