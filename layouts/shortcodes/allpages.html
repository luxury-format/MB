{{ $site := .Site }}
{{ $pages := .Site.Pages
   | where "Title" "ne" ""
   | where "Kind"  "page"
   | where "Type" "in"    (slice "page" "archive" "redirect" "photos")
   | where "Type" "not in" (slice "2025" "categories" "post")
   | where "Kind" "not in" (slice "section" "taxonomy" "home" "term")
   | where "Layout" "ne" "post"
   | where "Section" "not in" (slice "2025" "categories")
   | sort "Permalink"
}}

{{- define "allpages-link" -}}
  {{- $p := . -}}
  <strong>
    <a href="{{ $p.Permalink }}">
      {{ if $p.Title }}{{ upper $p.Title }}{{ else }}UNTITLED{{ end }}
    </a>
  </strong>
{{- end -}}

<ul class="allpages">
  {{ range $pages }}
    {{ if eq .Type "redirect" }}
      {{ with .Params.redirect }}
        {{ $raw := . }}
        {{ $clean := printf "/%s" (trimPrefix "/" $raw) | replaceRE "\\.(html|md)$" "" }}
        {{ $target := $site.GetPage $clean }}

        <li>
          {{ template "allpages-link" $. }}
           â€“ redirect to:
          {{ if $target }}
            {{ template "allpages-link" $target }}
            <small>({{ $target.RelPermalink }})</small>
          {{ else }}
            <a href="{{ $raw }}">{{ $raw }}</a>
            <span class="warning" role="alert">Warning: Target not found</span>
          {{ end }}
        </li>

      {{ else }}
        <li>
          {{ template "allpages-link" . }}
          <span class="warning" role="alert">Warning: No redirect URL</span>
        </li>
      {{ end }}

    {{ else }}
      <li>{{ template "allpages-link" . }}</li>
    {{ end }}
  {{ end }}
</ul>